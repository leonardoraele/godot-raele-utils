using System.Collections.Generic;
using Godot;
using Raele.GodotUtils.Extensions;

namespace Raele.GodotUtils.Messages;

public abstract partial class Command : Message
{
	//==================================================================================================================
		#region FIELDS
	//==================================================================================================================

	//==================================================================================================================
		#endregion
	//==================================================================================================================
		#region COMPUTED PROPERTIES
	//==================================================================================================================

	public bool Cancelled { get; private set; }

	//==================================================================================================================
		#endregion
	//==================================================================================================================
		#region SIGNALS
	//==================================================================================================================

	//==================================================================================================================
	#endregion
	//==================================================================================================================
	#region VIRTUALS & OVERRIDES
	//==================================================================================================================

	protected override IEnumerable<KeyValuePair<Variant, Variant>> _GetDetails()
		=> base._GetDetails()
			.AppendIf(this.Cancelled, new(nameof(this.Cancelled), this.Cancelled));

	protected override void _Publish()
		=> MessageBus.Singleton.Dispatch(this);

	protected virtual void _Execute() {}

	//==================================================================================================================
		#endregion
	//==================================================================================================================
		#region METHODS
	//==================================================================================================================

	public void Cancel()
		=> this.Cancelled = true;

	public void Execute()
		=> this._Execute();

	//==================================================================================================================
		#endregion
	//==================================================================================================================
}
